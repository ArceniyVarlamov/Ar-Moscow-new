# Союзмультпарк AR (WebAR)

Веб‑приложение дополненной реальности для «Союзмультпарка». Основано на A‑Frame + MindAR и работает прямо в браузере (без нативных приложений).

Основные режимы:
- Квест с подсказками мышки‑гида и эффектами на шагах (Волк → Гена → Чебурашка → Шапокляк → Трио → Стенд). 
- «Сфоткаться с героями» — одиночные сцены для выбранного персонажа (в том числе «Куча чебурашек» — логотип). 

## Технологии
- A‑Frame 1.4.2 (Three.js r147)
- MindAR (image tracking)
- Vanilla JS (модули в `public/js`), без сборщика

## Структура
- `public/index.html` — сцена A‑Frame, предзагрузка ассетов, базовый UI
- `public/app.js` — входной модуль, навигация между экранами и режимами
- `public/js/ar.js` — управление MindAR, контент сцен, переключение таргетов, камера, фото
- `public/js/guide.js` — гид (мышка): субтитры, mp3‑озвучка, fallback на TTS
- `public/js/effects.js` — визуальные эффекты (дождь апельсинов, и т.п.)
- `public/js/quest.js` — карта шагов квеста и таргетов
- `public/js/scenes.js` — загрузка и применение `config/scenes.json`
- `public/js/snapshot.js` — композиция снимка
- `public/assets/` — модели (`models`), таргеты MindAR (`targets`), музыка/озвучка (`music`), UI (`ui`)
- `public/config/scenes.json` — опциональная конфигурация сцен

## Использование
- Экран запуска: «Пройти квест» или «Сфоткаться с героями»
- Внутри AR‑экрана доступны кнопки: «Камера: …», «Сделать кадр», «Следующий герой»
- Гид показывает субтитры и озвучку, и автоматически продолжает квест при снимках

Параметры URL для отладки:
- `?debug=1` — расширенные логи glTF/AR
- `?noguide` или `?guide=off` — отключить гида

## Озвучка мышки (mp3)
Фразы гида сопоставлены с готовыми mp3 в `public/assets/music` (префикс `mouse_`). Ключи:
- helphim — «Поможем ему поймать зайца…» → `mouse_helphim.mp3`
- goodphoto — «Получилась отличная фотка!» → `mouse_goodphoto.mp3`
- gogena — «Идём к Гене…» → `mouse_gogena.mp3`
- gochebur — «Идём к Чебурашке…» → `mouse_gochebur.mp3`
- goshepok — «Идём к Шапокляк…» → `mouse_goshepok.mp3`
- gowolf — «Идём к Волку…» → `mouse_gowolf.mp3`
- eatcheese — «Ах, я не съела сыр…» → `mouse_eatcheese.mp3`
- park — «Пойдём в парк…» → `mouse_park.mp3`

Логика сопоставления — `js/guide.js` (`phraseToKey` + `ensureAudio`). Если нужно добавить новую фразу — положите файл `mouse_<key>.mp3` и расширьте `phraseToKey`.

## Добавление героя/сцены
1. Положите `.mind` таргет в `public/assets/targets`.
2. Добавьте ключ в `HERO_MIND_MAP` (`public/js/quest.js`).
3. (Опционально) Добавьте кнопку героя в `index.html` (блок «Выберите героя»).
4. Опишите поведение/контент сцены в `specForHero` (`public/js/ar.js`). Можно:
   - добавить GLB через `<a-assets>` и ссылаться на него `#assetId`;
   - или загрузить путь строкой через `safeSetGltfModel` (лениво, без предзагрузки).

## Снимки
Кнопка «Сделать кадр» сохраняет снимок (`compositeSnapshot`) с Canvas + видеопоток. Для шага Шапокляк добавлен «винтажный» фильтр.

## Оптимизация
Текущие «узкие места» — крупные GLB и множество `.mind`‑таргетов:

## Лицензии ассетов
GLB/аудио/изображения используются в рамках проекта; права на персонажей принадлежат их правообладателям. Третьи лица не должны переиспользовать ассеты вне согласованных условий.

---
По вопросам поддержки/оптимизации или добавления новых сцен — создавайте issue в репозитории или пишите в чат проекта.
